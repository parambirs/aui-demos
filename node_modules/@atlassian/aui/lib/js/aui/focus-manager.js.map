{"version":3,"sources":["js/aui/focus-manager.js"],"names":[],"mappings":"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","file":"js/aui/focus-manager.js","sourcesContent":["'use strict';\n\nimport $ from './jquery';\nimport globalize from './internal/globalize';\n\n(function initSelectors () {\n    /*\n    :tabbable and :focusable functions from jQuery UI v 1.10.4\n    renamed to :aui-tabbable and :aui-focusable to not clash with jquery-ui if it's included.\n    Code modified slightly to be compatible with jQuery < 1.8\n    .addBack() replaced with .andSelf()\n    $.curCSS() replaced with $.css()\n\n    */\n    function visible (element) {\n        return ($.css(element, 'visibility') === 'visible');\n    }\n\n    function focusable (element, isTabIndexNotNaN) {\n        var nodeName = element.nodeName.toLowerCase();\n\n        if (nodeName === 'aui-select') {\n            return true;\n        }\n\n        if (nodeName === 'area') {\n            var map = element.parentNode;\n            var mapName = map.name;\n            var imageMap = $('img[usemap=#' + mapName + ']').get();\n\n            if (!element.href || !mapName || map.nodeName.toLowerCase() !== 'map') {\n                return false;\n            }\n            return imageMap && visible(imageMap);\n        }\n        var isFormElement = /input|select|textarea|button|object/.test(nodeName);\n        var isAnchor = nodeName === 'a';\n        var isAnchorTabbable = (element.href || isTabIndexNotNaN);\n\n        return (\n            isFormElement ? !element.disabled :\n            (isAnchor ? isAnchorTabbable : isTabIndexNotNaN)\n        ) && visible(element);\n    }\n\n    function tabbable (element) {\n        var tabIndex = $.attr(element, 'tabindex'),\n        isTabIndexNaN = isNaN(tabIndex);\n        var hasTabIndex = (isTabIndexNaN || tabIndex >= 0);\n\n        return hasTabIndex && focusable(element, !isTabIndexNaN);\n    }\n\n    $.extend($.expr[ ':' ], {\n        'aui-focusable': function (element) {\n            return focusable(element, !isNaN($.attr(element, 'tabindex')));\n        },\n\n        'aui-tabbable': tabbable\n    });\n}());\n\nvar RESTORE_FOCUS_DATA_KEY = '_aui-focus-restore';\nfunction FocusManager() {\n    this._focusTrapStack = [];\n    $(document).on('focusout', {focusTrapStack: this._focusTrapStack},  focusTrapHandler);\n}\nFocusManager.defaultFocusSelector = ':aui-tabbable';\nFocusManager.prototype.enter = function ($el) {\n    // remember focus on old element\n    $el.data(RESTORE_FOCUS_DATA_KEY, $(document.activeElement));\n\n    // focus on new selector\n    if ($el.attr('data-aui-focus') !== 'false') {\n        var focusSelector = $el.attr('data-aui-focus-selector') || FocusManager.defaultFocusSelector;\n        var $focusEl = $el.is(focusSelector) ? $el : $el.find(focusSelector);\n        $focusEl.first().focus();\n    }\n\n    if (elementTrapsFocus($el)) {\n        trapFocus($el, this._focusTrapStack);\n    }\n};\n\nfunction trapFocus($el, focusTrapStack) {\n    focusTrapStack.push($el);\n}\n\nfunction untrapFocus(focusTrapStack) {\n    focusTrapStack.pop();\n}\n\nfunction elementTrapsFocus($el) {\n    return $el.is('.aui-dialog2');\n}\n\nFocusManager.prototype.exit = function ($el) {\n    if (elementTrapsFocus($el)) {\n        untrapFocus(this._focusTrapStack);\n    }\n\n    // AUI-1059: remove focus from the active element when dialog is hidden\n    var activeElement = document.activeElement;\n    if ($el[0] === activeElement || $el.has(activeElement).length) {\n        $(activeElement).blur();\n    }\n\n    var $restoreFocus = $el.data(RESTORE_FOCUS_DATA_KEY);\n    if ($restoreFocus && $restoreFocus.length) {\n        $el.removeData(RESTORE_FOCUS_DATA_KEY);\n        $restoreFocus.focus();\n    }\n};\n\nfunction focusTrapHandler(event) {\n    var focusTrapStack = event.data.focusTrapStack;\n\n    if (!event.relatedTarget) { //Does not work in firefox, see https://bugzilla.mozilla.org/show_bug.cgi?id=687787\n        return;\n    }\n\n    if (focusTrapStack.length === 0) {\n        return;\n    }\n\n    var $focusTrapElement = focusTrapStack[focusTrapStack.length - 1];\n\n    var focusOrigin = event.target;\n    var focusTo = event.relatedTarget;\n\n    var $tabbableElements = $focusTrapElement.find(':aui-tabbable');\n    var $firstTabbableElement = $($tabbableElements.first());\n    var $lastTabbableElement = $($tabbableElements.last());\n\n    var elementContainsOrigin = $focusTrapElement.has(focusTo).length === 0;\n    var focusLeavingElement = elementContainsOrigin && focusTo;\n    if (focusLeavingElement) {\n        if ($firstTabbableElement.is(focusOrigin)) {\n            $lastTabbableElement.focus();\n        } else if ($lastTabbableElement.is(focusOrigin)) {\n            $firstTabbableElement.focus();\n        }\n    }\n\n}\n\nFocusManager.global = new FocusManager();\n\nglobalize('FocusManager', FocusManager);\n\nexport default FocusManager;\n"],"sourceRoot":"/source/"}