{"version":3,"sources":["js/aui/layer.js"],"names":[],"mappings":"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","file":"js/aui/layer.js","sourcesContent":["'use strict';\n\nimport $ from './jquery';\nimport { dim, undim } from './blanket';\nimport FocusManager from './focus-manager';\nimport globalize from './internal/globalize';\nimport keyCode from './key-code';\nimport widget from './internal/widget';\n\nconst EVENT_PREFIX = '_aui-internal-layer-';\nconst GLOBAL_EVENT_PREFIX = '_aui-internal-layer-global-';\nconst LAYER_EVENT_PREFIX = 'aui-layer-';\nconst AUI_EVENT_PREFIX = 'aui-';\nvar $doc = $(document);\n\n// AUI-3708 - Abstracted to reflect code implemented upstream.\nfunction isTransitioning (el, prop) {\n    var transition = window.getComputedStyle(el).transitionProperty;\n    return transition ? transition.indexOf(prop) > -1 : false;\n}\n\nfunction onTransitionEnd (el, prop, func, once) {\n    function handler (e) {\n        if (prop !== e.propertyName) {\n            return;\n        }\n\n        func.call(el);\n\n        if (once) {\n            el.removeEventListener('transitionend', handler);\n        }\n    }\n\n    if (isTransitioning(el, prop)) {\n        el.addEventListener('transitionend', handler);\n    } else {\n        func.call(el);\n    }\n}\n\nfunction oneTransitionEnd (el, prop, func) {\n    onTransitionEnd(el, prop, func, true);\n}\n// end AUI-3708\n\nfunction ariaHide ($el) {\n    $el.attr('aria-hidden', 'true');\n}\n\nfunction ariaShow ($el) {\n    $el.attr('aria-hidden', 'false');\n}\n\nfunction triggerEvent ($el, deprecatedName, newNativeName) {\n    var e1 = $.Event(EVENT_PREFIX + deprecatedName);\n    var e2 = $.Event(GLOBAL_EVENT_PREFIX + deprecatedName);\n    // TODO: Remove this 'aui-layer-' prefixed event once it is no longer used by inline dialog and dialog2.\n    var nativeEvent = new CustomEvent(LAYER_EVENT_PREFIX + newNativeName, {\n        bubbles: true,\n        cancelable: true\n    });\n    var nativeEvent2 = new CustomEvent(AUI_EVENT_PREFIX + newNativeName, {\n        bubbles: true,\n        cancelable: true\n    });\n\n    $el.trigger(e1);\n    $el.trigger(e2, [$el]);\n    $el[0].dispatchEvent(nativeEvent);\n    $el[0].dispatchEvent(nativeEvent2);\n\n    return !e1.isDefaultPrevented() &&\n        !e2.isDefaultPrevented() &&\n        !nativeEvent.defaultPrevented &&\n        !nativeEvent2.defaultPrevented;\n}\n\nfunction Layer (selector) {\n    this.$el = $(selector || '<div class=\"aui-layer\" aria-hidden=\"true\"></div>');\n    this.$el.addClass('aui-layer');\n}\n\nLayer.prototype = {\n    /**\n     * Returns the layer below the current layer if it exists.\n     *\n     * @returns {jQuery | undefined}\n     */\n    below: function () {\n        return LayerManager.global.item(LayerManager.global.indexOf(this.$el) - 1);\n    },\n\n    /**\n     * Returns the layer above the current layer if it exists.\n     *\n     * @returns {jQuery | undefined}\n     */\n    above: function () {\n        return LayerManager.global.item(LayerManager.global.indexOf(this.$el) + 1);\n    },\n\n    /**\n     * Sets the width and height of the layer.\n     *\n     * @param {Integer} width The width to set.\n     * @param {Integer} height The height to set.\n     *\n     * @returns {Layer}\n     */\n    changeSize: function (width, height) {\n        this.$el.css('width', width);\n        this.$el.css('height', height === 'content' ? '' : height);\n        return this;\n    },\n\n    /**\n     * Binds a layer event.\n     *\n     * @param {String} event The event name to listen to.\n     * @param {Function} fn The event handler.\n     *\n     * @returns {Layer}\n     */\n    on: function (event, fn) {\n        this.$el.on(EVENT_PREFIX + event, fn);\n        return this;\n    },\n\n\n    /**\n     * Unbinds a layer event.\n     *\n     * @param {String} event The event name to unbind=.\n     * @param {Function} fn Optional. The event handler.\n     *\n     * @returns {Layer}\n     */\n    off: function (event, fn) {\n        this.$el.off(EVENT_PREFIX + event, fn);\n        return this;\n    },\n\n    /**\n     * Shows the layer.\n     *\n     * @returns {Layer}\n     */\n    show: function () {\n        if (this.isVisible()) {\n            ariaShow(this.$el);\n            return this;\n        }\n\n        if (!triggerEvent(this.$el, 'beforeShow', 'show')) {\n            return this;\n        }\n\n        // AUI-3708\n        // Ensures that the display property is removed if it's been added\n        // during hiding.\n        if (this.$el.css('display') === 'none') {\n            this.$el.css('display', '');\n        }\n\n        LayerManager.global.push(this.$el);\n\n        return this;\n    },\n\n    /**\n     * Hides the layer.\n     *\n     * @returns {Layer}\n     */\n    hide: function () {\n        if (!this.isVisible()) {\n            ariaHide(this.$el);\n            return this;\n        }\n\n        if (!triggerEvent(this.$el, 'beforeHide', 'hide')) {\n            return this;\n        }\n\n        // AUI-3708\n        oneTransitionEnd(this.$el.get(0), 'opacity', function () {\n            this.style.display = 'none';\n        });\n\n        LayerManager.global.popUntil(this.$el);\n\n        return this;\n    },\n\n    /**\n     * Checks to see if the layer is visible.\n     *\n     * @returns {Boolean}\n     */\n    isVisible: function () {\n        return this.$el.attr('aria-hidden') === 'false';\n    },\n\n    /**\n     * Removes the layer and cleans up internal state.\n     *\n     * @returns {undefined}\n     */\n    remove: function () {\n        this.hide();\n        this.$el.remove();\n        this.$el = null;\n    },\n\n    /**\n     * Returns whether or not the layer is blanketed.\n     *\n     * @returns {Boolean}\n     */\n    isBlanketed: function () {\n        return this.$el.attr('data-aui-blanketed') === 'true';\n    },\n\n    /**\n     * Returns whether or not the layer is persistent.\n     *\n     * @returns {Boolean}\n     */\n    isPersistent: function () {\n        var modal = this.$el.attr('modal') || this.$el.attr('data-aui-modal');\n        var isPersistent = this.$el[0].hasAttribute('persistent');\n\n        return modal === 'true' || isPersistent;\n    },\n\n    _hideLayer: function (triggerBeforeEvents) {\n        if (this.isPersistent() || this.isBlanketed()) {\n            FocusManager.global.exit(this.$el);\n        }\n\n        if (triggerBeforeEvents) {\n            triggerEvent(this.$el, 'beforeHide', 'hide');\n        }\n\n        this.$el.attr('aria-hidden', 'true');\n        this.$el.css('z-index', this.$el.data('_aui-layer-cached-z-index') || '');\n        this.$el.data('_aui-layer-cached-z-index', '');\n        this.$el.trigger(EVENT_PREFIX + 'hide');\n        this.$el.trigger(GLOBAL_EVENT_PREFIX + 'hide', [this.$el]);\n    },\n\n    _showLayer: function (zIndex) {\n        if (!this.$el.parent().is('body')) {\n            this.$el.appendTo(document.body);\n        }\n\n        this.$el.data('_aui-layer-cached-z-index', this.$el.css('z-index'));\n        this.$el.css('z-index', zIndex);\n        this.$el.attr('aria-hidden', 'false');\n\n        if (this.isPersistent() || this.isBlanketed()) {\n            FocusManager.global.enter(this.$el);\n        }\n\n        this.$el.trigger(EVENT_PREFIX + 'show');\n        this.$el.trigger(GLOBAL_EVENT_PREFIX + 'show', [this.$el]);\n    }\n};\n\nvar createLayer = widget('layer', Layer);\n\ncreateLayer.on = function (eventName, selector, fn) {\n    $doc.on(GLOBAL_EVENT_PREFIX + eventName, selector, fn);\n    return this;\n};\n\ncreateLayer.off = function (eventName, selector, fn) {\n    $doc.off(GLOBAL_EVENT_PREFIX + eventName, selector, fn);\n    return this;\n};\n\n\n\n// Layer Manager\n// -------------\n\n/**\n * Manages layers.\n *\n * There is a single global layer manager.\n * Additional instances can be created however this should generally only be used in tests.\n *\n * Layers are added by the push($el) method. Layers are removed by the\n * popUntil($el) method.\n *\n * popUntil's contract is that it pops all layers above & including the given\n * layer. This is used to support popping multiple layers.\n * Say we were showing a dropdown inside an inline dialog inside a dialog - we\n * have a stack of dialog layer, inline dialog layer, then dropdown layer. Calling\n * popUntil(dialog.$el) would hide all layers above & including the dialog.\n */\n\nfunction getTrigger ($layer) {\n    return $('[aria-controls=\"' + $layer.attr('id') + '\"]');\n}\n\nfunction hasTrigger ($layer) {\n    return getTrigger($layer).length > 0;\n}\n\nfunction topIndexWhere (layerArr, fn) {\n    var i = layerArr.length;\n\n    while (i--) {\n        if (fn(layerArr[i])) {\n            return i;\n        }\n    }\n\n    return -1;\n}\n\nfunction layerIndex (layerArr, $el) {\n    return topIndexWhere(layerArr, function ($layer) {\n        return $layer[0] === $el[0];\n    });\n}\n\nfunction topBlanketedIndex (layerArr) {\n    return topIndexWhere(layerArr, function ($layer) {\n        return createLayer($layer).isBlanketed();\n    });\n}\n\nfunction nextZIndex (layerArr) {\n    var _nextZIndex;\n\n    if (layerArr.length) {\n        var $topEl = layerArr[layerArr.length - 1];\n        var zIndex = parseInt($topEl.css('z-index'), 10);\n        _nextZIndex = (isNaN(zIndex) ? 0 : zIndex) + 100;\n    } else {\n        _nextZIndex = 0;\n    }\n\n    return Math.max(3000, _nextZIndex);\n}\n\nfunction updateBlanket (stack, oldBlanketIndex) {\n    var newTopBlanketedIndex = topBlanketedIndex(stack);\n\n    if (oldBlanketIndex !== newTopBlanketedIndex) {\n        if (newTopBlanketedIndex > -1) {\n            dim(false, stack[newTopBlanketedIndex].css('z-index') - 20);\n        } else {\n            undim();\n        }\n    }\n}\n\nfunction popLayers (stack, stopIndex, forceClosePersistent) {\n    if (stopIndex < 0) {\n        return;\n    }\n\n    for (var a = stack.length - 1; a >= stopIndex; a--) {\n        var $layer = stack[a];\n        var layer = createLayer($layer);\n\n        if (forceClosePersistent || !layer.isPersistent()) {\n            layer._hideLayer(true);\n            stack.splice(a, 1);\n        }\n    }\n}\n\nfunction getParentLayer ($childLayer) {\n    var $layerTrigger = getTrigger($childLayer);\n\n    if ($layerTrigger.length > 0) {\n        return $layerTrigger.closest('.aui-layer');\n    }\n}\n\nfunction LayerManager () {\n    this._stack = [];\n}\n\nLayerManager.prototype = {\n    /**\n    * Pushes a layer onto the stack. The same element cannot be opened as a layer multiple times - if the given\n    * element is already an open layer, this method throws an exception.\n    *\n    * @param {HTMLElement | String | jQuery} element  The element to push onto the stack.\n    *\n    * @returns {LayerManager}\n    */\n    push: function (element) {\n        var $el = (element instanceof $) ? element : $(element);\n        if (layerIndex(this._stack, $el) >= 0) {\n            throw new Error('The given element is already an active layer.');\n        }\n\n        this.popLayersBeside($el);\n\n        var layer = createLayer($el);\n        var zIndex = nextZIndex(this._stack);\n\n        layer._showLayer(zIndex);\n\n        if (layer.isBlanketed()) {\n            dim(false, zIndex - 20);\n        }\n\n        this._stack.push($el);\n\n        return this;\n    },\n\n    popLayersBeside: function (element) {\n        var $layer = (element instanceof $) ? element : $(element);\n        if (!hasTrigger($layer)) {\n            // We can't find this layer's trigger, we will pop all non-persistent until a blanket or the document\n            var blanketedIndex = topBlanketedIndex(this._stack);\n            popLayers(this._stack, ++blanketedIndex, false);\n            return;\n        }\n\n        var $parentLayer = getParentLayer($layer);\n        if ($parentLayer) {\n            var parentIndex = this.indexOf($parentLayer);\n            popLayers(this._stack, ++parentIndex, false);\n        } else {\n            popLayers(this._stack, 0, false);\n        }\n\n    },\n\n    /**\n    * Returns the index of the specified layer in the layer stack.\n    *\n    * @param {HTMLElement | String | jQuery} element  The element to find in the stack.\n    *\n    * @returns {Number} the (zero-based) index of the element, or -1 if not in the stack.\n    */\n    indexOf: function (element) {\n        return layerIndex(this._stack, $(element));\n    },\n\n    /**\n    * Returns the item at the particular index or false.\n    *\n    * @param {Number} index The index of the element to get.\n    *\n    * @returns {jQuery | Boolean}\n    */\n    item: function (index) {\n        return this._stack[index];\n    },\n\n    /**\n    * Hides all layers in the stack.\n    *\n    * @returns {LayerManager}\n    */\n    hideAll: function () {\n        this._stack.reverse().forEach(function (element) {\n            var layer = createLayer(element);\n            if (layer.isBlanketed() || layer.isPersistent()) {\n                return;\n            }\n            layer.hide();\n        });\n\n        return this;\n    },\n\n    /**\n    * Gets the previous layer below the given layer, which is non modal and non persistent. If it finds a blanketed layer on the way\n    * it returns it regardless if it is modal or not\n    *\n    * @param {HTMLElement | String | jQuery} element layer to start the search from.\n    *\n    * @returns {jQuery | null} the next matching layer or null if none found.\n    */\n    getNextLowerNonPersistentOrBlanketedLayer: function (element) {\n        var $el = (element instanceof $) ? element : $(element);\n        var index = layerIndex(this._stack, $el);\n\n        if (index < 0) {\n            return null;\n        }\n\n        var $nextEl;\n        index--;\n        while (index >= 0) {\n            $nextEl = this._stack[index];\n            var layer = createLayer($nextEl);\n\n            if (!layer.isPersistent() || layer.isBlanketed()) {\n                return $nextEl;\n            }\n            index--;\n        }\n\n        return null;\n    },\n\n    /**\n    * Gets the next layer which is neither modal or blanketed, from the given layer.\n    *\n    * @param {HTMLElement | String | jQuery} element layer to start the search from.\n    *\n    * @returns {jQuery | null} the next non modal non blanketed layer or null if none found.\n    */\n    getNextHigherNonPeristentAndNonBlanketedLayer: function (element) {\n        var $el = (element instanceof $) ? element : $(element);\n        var index = layerIndex(this._stack, $el);\n\n        if (index < 0) {\n            return null;\n        }\n\n        var $nextEl;\n        index++;\n        while (index < this._stack.length) {\n            $nextEl = this._stack[index];\n            var layer = createLayer($nextEl);\n\n            if (!(layer.isPersistent() || layer.isBlanketed())) {\n                return $nextEl;\n            }\n            index++;\n        }\n\n        return null;\n    },\n\n    /**\n    * Removes all non-modal layers above & including the given element. If the given element is not an active layer, this method\n    * is a no-op. The given element will be removed regardless of whether or not it is modal.\n    *\n    * @param {HTMLElement | String | jQuery} element layer to pop.\n    *\n    * @returns {jQuery} The last layer that was popped, or null if no layer matching the given $el was found.\n    */\n    popUntil: function (element) {\n        var $el = (element instanceof $) ? element : $(element);\n        var index = layerIndex(this._stack, $el);\n\n        if (index === -1) {\n            return null;\n        }\n\n        var oldTopBlanketedIndex = topBlanketedIndex(this._stack);\n\n        // Removes all layers above the current one.\n        popLayers(this._stack, index + 1, createLayer($el).isBlanketed());\n\n        // Removes the current layer.\n        createLayer($el)._hideLayer();\n        this._stack.splice(index, 1);\n\n        updateBlanket(this._stack, oldTopBlanketedIndex);\n\n        return $el;\n    },\n\n    /**\n    * Gets the top layer, if it exists.\n    *\n    * @returns The layer on top of the stack, if it exists, otherwise null.\n    */\n    getTopLayer: function () {\n        if (!this._stack.length) {\n            return null;\n        }\n\n        var $topLayer = this._stack[this._stack.length - 1];\n\n        return $topLayer;\n    },\n\n    /**\n    * Pops the top layer, if it exists and it is non modal and non persistent.\n    *\n    * @returns The layer that was popped, if it was popped.\n    */\n    popTopIfNonPersistent: function () {\n        var $topLayer = this.getTopLayer();\n        var layer = createLayer($topLayer);\n\n        if (!$topLayer || layer.isPersistent()) {\n            return null;\n        }\n\n        return this.popUntil($topLayer);\n    },\n\n    /**\n    * Pops all layers above and including the top blanketed layer. If layers exist but none are blanketed, this method\n    * does nothing.\n    *\n    * @returns The blanketed layer that was popped, if it exists, otherwise null.\n    */\n    popUntilTopBlanketed: function () {\n        var i = topBlanketedIndex(this._stack);\n\n        if (i < 0) {\n            return null;\n        }\n\n        var $topBlanketedLayer = this._stack[i];\n        var layer = createLayer($topBlanketedLayer);\n\n        if (layer.isPersistent()) {\n            // We can't pop the blanketed layer, only the things ontop\n            var $next = this.getNextHigherNonPeristentAndNonBlanketedLayer($topBlanketedLayer);\n            if ($next) {\n                var stopIndex = layerIndex(this._stack, $next);\n                popLayers(this._stack, stopIndex, true);\n                return $next;\n            }\n            return null;\n        }\n\n        popLayers(this._stack, i, true);\n        updateBlanket(this._stack, i);\n        return $topBlanketedLayer;\n    },\n\n    /**\n    * Pops all layers above and including the top persistent layer. If layers exist but none are persistent, this method\n    * does nothing.\n    */\n    popUntilTopPersistent: function () {\n        var $toPop = LayerManager.global.getTopLayer();\n        if (!$toPop) {\n            return;\n        }\n\n        var stopIndex;\n        var oldTopBlanketedIndex = topBlanketedIndex(this._stack);\n\n        var toPop = createLayer($toPop);\n        if (toPop.isPersistent()) {\n            if (toPop.isBlanketed()) {\n                return;\n            } else {\n                // Get the closest non modal layer below, stop at the first blanketed layer though, we don't want to pop below that\n                $toPop = LayerManager.global.getNextLowerNonPersistentOrBlanketedLayer($toPop);\n                toPop = createLayer($toPop);\n\n                if ($toPop && !toPop.isPersistent()) {\n                    stopIndex = layerIndex(this._stack, $toPop);\n                    popLayers(this._stack, stopIndex, true);\n                    updateBlanket(this._stack, oldTopBlanketedIndex);\n                } else {\n                    // Here we have a blanketed persistent layer\n                    return;\n                }\n            }\n        } else {\n            stopIndex = layerIndex(this._stack, $toPop);\n            popLayers(this._stack, stopIndex, true);\n            updateBlanket(this._stack, oldTopBlanketedIndex);\n        }\n    }\n};\n\n// LayerManager.global\n// -------------------\n\nfunction initCloseLayerOnEscPress() {\n    $doc.on('keydown', function (e) {\n        if (e.keyCode === keyCode.ESCAPE) {\n            LayerManager.global.popUntilTopPersistent();\n            e.preventDefault();\n        }\n    });\n}\n\nfunction initCloseLayerOnBlanketClick() {\n    $doc.on('click', '.aui-blanket', function (e) {\n        if (LayerManager.global.popUntilTopBlanketed()) {\n            e.preventDefault();\n        }\n    });\n}\n\nfunction hasLayer($trigger) {\n    if (!$trigger.length) {\n        return false;\n    }\n\n    var layer = document.getElementById($trigger.attr('aria-controls'));\n    return LayerManager.global.indexOf(layer) > -1;\n}\n\n// If it's a click on a trigger, do nothing.\n// If it's a click on a layer, close all layers above.\n// Otherwise, close all layers.\nfunction initCloseLayerOnOuterClick () {\n    $doc.on('click', function (e) {\n        var $target = $(e.target);\n        if ($target.closest('.aui-blanket').length) {\n            return;\n        }\n\n        var $trigger = $target.closest('[aria-controls]');\n        var $layer = $target.closest('.aui-layer');\n        if (!$layer.length && !hasLayer($trigger)) {\n            LayerManager.global.hideAll();\n            return;\n        }\n\n        // Triggers take precedence over layers\n        if (hasLayer($trigger)) {\n            return;\n        }\n\n        if ($layer.length) {\n            // We dont want to explicitly call close on a modal dialog if it happens to be next.\n            // All blanketed layers should be below us, as otherwise the blanket should have caught the click.\n            // We make sure we dont close a blanketed one explicitly as a hack, this is to fix the problem arising\n            // from dialog2 triggers inside dialog2's having no aria controls, where the dialog2 that was just\n            // opened would be closed instantly\n            var $next = LayerManager.global.getNextHigherNonPeristentAndNonBlanketedLayer($layer);\n\n            if ($next) {\n                createLayer($next).hide();\n            }\n        }\n    });\n}\n\ninitCloseLayerOnEscPress();\ninitCloseLayerOnBlanketClick();\ninitCloseLayerOnOuterClick();\n\nLayerManager.global = new LayerManager();\ncreateLayer.Manager = LayerManager;\n\nglobalize('layer', createLayer);\n\nexport default createLayer;\n"],"sourceRoot":"/source/"}